var PhotoAlbum=function(){function PhotoAlbum(imageUrls){this.index=-1,this.timer=null,this.shouldStop=!0,this.urls=imageUrls,ArrayUtils.shuffle(this.urls)}return PhotoAlbum.prototype.start=function(){var _this=this;this.shouldStop=!1,this.stopTimer(),this.cacheNext((function(){_this.displayCurrentAndCacheNext()}))},PhotoAlbum.prototype.stop=function(){this.shouldStop=!0,this.stopTimer()},PhotoAlbum.prototype.toggle=function(){this.isPlaying?this.stop():this.start()},Object.defineProperty(PhotoAlbum.prototype,"isPlaying",{get:function(){return!this.shouldStop},enumerable:!0,configurable:!0}),PhotoAlbum.prototype.imageUrl=function(partialPath){return"album/"+partialPath},PhotoAlbum.prototype.display=function(callback){var imageRef=this.urls[this.index],url=this.imageUrl(imageRef[0]),caption=imageRef[1];$("#album .overlay").fadeIn(PhotoAlbum.transitionTime,(function(){$("#album").css("background-image","url("+url+")"),$("#album .caption").html(caption),$("#album .overlay").fadeOut(PhotoAlbum.transitionTime,callback)}))},PhotoAlbum.prototype.cacheNext=function(callback){this.index+=1,this.index>=this.urls.length&&(ArrayUtils.shuffle(this.urls),this.index=0);var imageRef=this.urls[this.index],url=this.imageUrl(imageRef[0]),image=new Image;image.onload=callback,image.src=url},PhotoAlbum.prototype.displayCurrentAndCacheNext=function(){var _this=this;this.display((function(){var cacheStart=new Date;_this.cacheNext((function(){var cacheStop,cacheDuration=+new Date-+cacheStart;_this.shouldStop||(_this.timer=setTimeout((function(){_this.displayCurrentAndCacheNext()}),Math.max(PhotoAlbum.displayTime-cacheDuration,0)))}))}))},PhotoAlbum.prototype.stopTimer=function(){clearTimeout(this.timer),this.timer=null},PhotoAlbum.transitionTime=800,PhotoAlbum.displayTime=2500,PhotoAlbum}();